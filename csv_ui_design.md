# CSV 기능 UI 설계서

## 1. 화면 개요
- 대상 화면: **상품 목록 화면 (/stocks)**
- 목적: CSV 파일을 통해 재고 데이터를 대량으로 **내보내기 / 업로드 / 드라이런 검증**할 수 있는 기능 제공.
- 접근 방식: 기존 재고 목록 화면의 상단 툴바에 CSV 기능을 자연스럽게 통합.

---

## 2. 사용자 시나리오
1. 사용자가 목록 화면에서 현재 재고 상태를 CSV로 다운로드한다.
2. 사용자가 CSV에서 데이터를 수정한 뒤, 다시 업로드한다.
3. 실제 데이터 반영 전에 **드라이런(dry-run)** 모드로 오류 여부를 확인한다.
4. 문제가 없다면 실제 반영을 수행한다.

---

## 3. 상단 툴바 구조
툴바 구성은 다음과 같이 좌 → 우 순서로 정렬한다.

### ● 좌측 영역: 검색
- 라벨: `검색`
- 입력 필드: 상품명 또는 코드를 입력
- 플레이스홀더: `상품명 또는 코드 검색`

### ● 중앙 영역: 카테고리 선택
- 라벨: `카테고리`
- 셀렉트 박스: `전체` + 실제 카테고리 목록

### ● 우측 영역: CSV 기능 버튼
1. **CSV 내보내기**
   - 현재 검색·필터 조건을 그대로 적용한 목록을 export
2. **CSV 업로드**
   - 클릭 시 업로드 모달 창 표시

---

## 4. CSV 업로드 모달 설계
### ● 모달 제목
- `CSV 업로드`

### ● 내부 구성 요소
1. **파일 입력 영역**
   - 라벨: `CSV 파일 선택`
   - 파일 선택 input

2. **옵션 영역**
   - 체크박스: `드라이런 모드로 실행`
   - 주석 설명:
     - 드라이런 모드: 실제 저장 없이 유효성 검사만 진행
     - 비드라이런: 유효한 데이터는 즉시 DB 반영

3. **버튼 영역**
   - `취소`
   - `업로드` (파일 미선택 시 비활성화)

---

## 5. 업로드 후 결과 처리 방식
### ● 공통
- 모달 닫기 후 화면 우측 하단 또는 상단에 토스트 메시지 표시.

### ● 드라이런 모드 결과
- 목록 테이블 아래에 결과 블록 표시:
  - `총 N건 중 성공 X건, 오류 Y건`

### ● 오류 목록 테이블
컬럼 구성:
- 행 번호 (CSV의 index)
- 오류 유형
- 오류 메시지
- 원본 데이터 일부 요약

---

## 6. CSV 내보내기 동작
### ● 요청 방식
- `GET /api/stocks/csv/export?keyword=...&categoryId=...`
- 현재 화면의 필터 그대로 전달

### ● 응답
- `Content-Type: text/csv`
- 파일명 예시: `stocks_20250101_153000.csv`

### ● CSV 컬럼 예시
- `id`
- `name`
- `inventory`
- `categoryId`
- `updatedAt`

---

## 7. CSV 업로드 API 사양
### ● 요청 (업로드)
- `POST /api/stocks/csv/import`
- `multipart/form-data`
  - `file`: CSV 파일
  - `dryRun`: true/false

### ● 응답 예시 (dry-run)
```json
{
  "success": true,
  "dryRun": true,
  "summary": {
    "total": 120,
    "successCount": 110,
    "errorCount": 10
  },
  "errors": [
    {
      "rowNumber": 5,
      "code": "MISSING_INVENTORY",
      "message": "inventory 값이 비어 있습니다.",
      "raw": {
        "name": "예시상품",
        "inventory": "",
        "categoryId": "3"
      }
    }
  ]
}
```

---

## 8. 에러 케이스 정리
1. **파일 미선택** → 업로드 버튼 비활성화
2. **CSV 형식 아님** → 토스트 메시지로 경고
3. **서버 오류 발생** → `CSV 처리 중 오류가 발생했습니다.` 메시지 표시

---

## 9. 다음 단계
1. 이 문서를 기준으로 **독립 HTML 데모 (`stock_csv_demo.html`) 제작**
2. 이후 JS / CSS 분리하면서 실제 UI처럼 동작하도록 구성
3. 마지막 단계에서 실제 프로젝트에 적용할 파일 변경 계획 정리

